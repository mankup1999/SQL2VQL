select substr(ord_actn_strt_date_key,1,6) as month_yyyymm , substr(to_char(to_date(ord_actn_strt_date_key,'yyyymmdd') ,'day'),1,3) as oed_day ,to_date(ord_actn_strt_date_key ,'yyyymmdd') as oed_date , main_cmpn_nm as subs_line_bsns_ds , ord_actn_strt_date_key , ord_actn_stts_ds , ord_actn_type_ds , count(dis tinct ord_actn_id) as vol  from ( select distinct ord_tran .ord_actn_id as ord_actn_id , ord_tran. ord_actn_strt_ts as ord_actn_strt_ts , ord_t ran.ord_actn_strt_date_key, ord_tran.main_cmpn _nm, ord_tran.assg_prod_id as assg_prod_ id , ord_tran.main_cmpn_id, ord_tran.assg_prce_plan_id as assg_prce_plan_id, ord_tran.cust_rqst_ts, ord_tran.serv_type_ cd as serv_type_cd, ord_tran.ord_actn_do ne_ts as ord_actn_done_ts , ord_tran.ord_act n_done_date_key, ord_tran.deal_id, ord_tran.deal_nm, ord_tran.ord_id as order_id , ord_tran.ord_lvl_type_id as ord_lvl_type , /*ord_tran.ord_tran_year_ mnth_no, ord_tran.vndr_id, o rd_tran.vndr_nm,*/ subs.prim_rsrc_valu_txt as prim_rsrc_valu_txt , subs.subs_id as subs_id , subs.accs_lkge_id, subs.bb_user_nm, oa_stts.ord_actn_s tts_ds as ord_actn_stts_ds , oa_type.ord_ac tn_type_ds as ord_actn_type_ds , oa_rsn.ord _actn_rsn_ds as ord_actn_rsn_ds , ctct.id nt_doc_1_no as cust_ctct_idnt_doc_1_no , ctct.frst_nm, cust.cust_id, assg_bill_offr.bill_offr_ds bill_offr_ds, assg_bill_offr.base_plan_ind, assg_cmpn_offr.p rod_ds cmpn_prod_ds, assg_prod_stat.assg_prod_ stat_id, chnl_nm.sale_serv_chnl_nm /*main_prod_offr.prod_ds as main_prod_offr_ds*/  from ep_rel.ord_tran LEFT OUTER JOIN (select subs_key,bb_user_nm,accs_lkge_ id,subs_id,prim_rsrc_valu_txt,open_ts,clse_ts  from ep_rel.subs where ecf_delt_flg = 0) subs ON ord_tran.subs_key = subs.subs_key  and ord_tran.open_ts >= subs.open_ts  and ord_tran.open_ts < subs.clse_ts  LEFT OUTER JOIN (select ord_actn _stts_key,ord_actn_stts_ds,open_ts,clse_ts  from ep_rel.ord_actn_stts where ecf_delt_flg = 0) oa_stts ON ord_tran.ord_actn_stts_key = oa_stts.ord_ actn_stts_key  and ord_tran.open_ts >= oa_stts.open_ts  and ord_tran.open_ts < oa_stts.clse_ts  LEFT OUTER JOIN (select ord_actn_type_key,ord_actn_type_ds,ord_actn_typ e_id,open_ts,clse_ts  from ep_rel.ord_actn_type where e cf_delt_flg = 0) oa_type ON ord_tran.open_ts >= oa_type.open_ts  LEFT OUTER JOIN (select ord_actn_rsn_key,ord_a ctn_rsn_ds,ord_actn_rsn_id,open_ts,clse_ts  from ep_rel.ord_actn_rsn where ecf_delt_flg = 0) oa_rsn ON ord_tran.ord_actn_rsn_key = oa_rsn.ord_actn_rsn_key  and ord_tran.open_ts < oa_rsn.c lse_ts  LEFT OUTER JOIN (select ctct_key,idnt_doc_1_no,open_ts,clse_ts,frst_nm  from ep_rel.ctct where ecf_delt_flg = 0) ctct ON ord_tran.main_ctct_key = ctct.ctct_key and ord_tran.open_ts >= ctct.open_t s  and ord_tran.open_ts < ctct.clse_ts  LEFT OUTER JOIN (select cust_key,cust_id,open_ts,clse_ts  from ep_rel.cust where ecf_ delt_flg = 0) cust ON ord_tran.cust_key = cust.cust_key and ord_tran.open_ts >= cust.open_ts  and ord_tran.open_ts < cust.clse_ts  LEFT OUTER JOIN (select base_plan_ind,open _ts,clse_ts,bill_offr_key,bill_offr_ds  from e p_rel.bill_offr where ecf_delt_flg = 0) assg_bill_offr ON ord_tran.open_ts < assg_bill_offr.clse_ts  LEFT OUTER JOIN (select prod_ctlg_item_id,prod_ctlg_key, prod_ds,open_ts,c lse_ts  from ep_rel.prod_ctlg where ecf_delt_ flg = 0) assg_cmpn_offr ON ord_tran.prod_ctlg_key = assg_cmpn_offr.prod_ct lg_key  and ord_tran.open_ts >= assg_cmpn_offr.open_ts  and ord_tran.open_ts < assg_cmpn_offr.clse_ ts  LEFT OUTER JOIN (select assg_prod_stat_id, open_ts,clse_ts,assg_prod_stat_key  from e p_rel.assg_prod_stat where ecf_delt_flg = 0) assg_prod_stat ON ord_tran.open_ts >= assg_prod_stat. open_ts  LEFT OUTER JOIN (select sale_serv_chnl_key, sale_serv_chnl_nm, open_ts, cl se_ts  from ep_rel.sale_serv_chnl where ecf_ delt_flg = 0) chnl_nm ON ord_tran.init_sale_serv_ch nl_key = chnl_nm.sale_serv_chnl_key and ord_tran.open_ts < chnl_nm.c lse_ts  LEFT OUTER JOIN (select prod_ctlg_item_id,prod_c tlg_key, prod_ds,open_ts,clse_ts  from ep_rel. prod_ctlg where ecf_delt_flg = 0) main_prod_offr where upper(ord_tran.main_cmpn_nm) in ('tv main','cro ss carriage main') and upper(oa_type.ord_actn_type_ds) in ( 'p rovide' ) and ord_tran.ecf_delt_flg = 0 and upper(ctct.frst_ nm) not like 'brt%' and ord_tran.ord_actn_strt_date_key between to_number(to_char(trunc(sysdate-15),'yyyymmdd')) and to_number (to_char(trunc(sysdate-1),'yyyymmdd'))) where bill_offr_ds is not null and upper(ord_actn_stts_ds) in ('done', 'delivery', 'c ompletion') and cmpn_prod_ds = 'tv plan' --exclude shcc i.e. 'c ross carriage main' and bill_offr_ds not in ('singtel tv select ', 'early bird 2018 fifa world cup russia (tm) @$94.16', 'ala-ca rte 2018 fifa world cup russia (tm) @ $112.35', 'ala-carte 2018 fifa world cup russia (tm) @ $112.35 (cc)') group by substr(ord _actn_strt_date_key,1,6) , main_cmpn_nm , ord_actn _strt_date_key , ord_actn_stts_ds , ord_actn_type_ ds order by 3;