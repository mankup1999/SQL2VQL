create table bcc_wk_miotv_ga_oed_raw as select distinct ord_tra n.ord_actn_id as ord_actn_id , ord_tran.o rd_actn_strt_ts as ord_actn_strt_ts , ord_tran .ord_actn_strt_date_key, ord_tran.main_cmpn_nm, ord_tran.assg_prod_id as assg_prod_id , ord_tran.main_cmpn_id, ord_tran.as sg_prce_plan_id as assg_prce_plan_id, ord_tran. serv_type_cd as serv_type_cd, ord_tran.ord _actn_done_ts as ord_actn_done_ts , ord_tran.o rd_actn_done_date_key, ord_tran.deal_id, ord_tran.deal_nm, -- added on 13 aug 18 empl.empl_or_ssmn_cd, -- added on 13 aug 18 subs.prim_rsrc_valu_txt as prim_rsrc_valu_txt , subs.subs_id as subs_id , oa_stts.ord_actn_stts_ds as ord_actn_stts_ds , oa_type.ord_actn_type_ds as ord_actn_type_ds , oa_rsn.ord_actn_rsn_ds as ord_actn_rsn_ds , ctct.idnt_doc_1_no as cust_ctct_idnt_doc_1_no , ctct.frst_nm, cust.cust_id, assg_bill_offr.bill_offr_ds bill_offr_ds, assg_bill_offr.base_plan_ind, assg_cmp n_offr.prod_ds cmpn_prod_ds, assg_prod_stat.assg _prod_stat_id, chnl_nm.sale_serv_chnl_nm  from ep_rel.ord_tran LEFT OUTER JOIN (select subs_key,subs_id,prim_rsrc_valu_t xt,open_ts,clse_ts  from ep_rel.subs where ecf_d elt_flg = 0) subs ON ord_tran.subs_key = subs.subs_key  and ord_tran.open _ts >= subs.open_ts  and ord_tran.open_ts < subs.clse_ts  LEFT OUTER JOIN (select ord_actn_stts_key,o rd_actn_stts_ds,open_ts,clse_ts  from ep_rel.ord _actn_stts where ecf_delt_flg = 0) oa_stts ON ord_tran.open_ts >= oa_stts.open_ts  and ord_tran.open_ts < oa_stts.clse_ts  LEFT OUTER JOIN (select or d_actn_type_key,ord_actn_type_ds,ord_actn_type_id,open_ts,clse_t s  from ep_rel.ord_actn_type where ecf_delt_flg = 0) oa_type ON ord_tran.ord_actn_type_key = oa_type.ord_actn_type_key  and ord_tran.open_ts > = oa_type.open_ts  LEFT OUTER JOIN (select ord_actn_rsn_key,ord_actn_rsn_ds,ord_actn_rsn_id, open_ts,clse_ts  from ep_rel.ord_actn_rsn where ecf_delt_flg = 0) oa_rsn ON ord_tran.ord_actn_rsn_k ey = oa_rsn.ord_actn_rsn_key  and ord_tran.open_ts < oa_rsn.cls e_ts  LEFT OUTER JOIN (select ctct_key,idnt_doc_1_no,open_ts,cl se_ts,frst_nm  from ep_rel.ctct where ecf_d elt_flg = 0) ctct ON ord_tran.main_ctct_ key = ctct.ctct_key and ord_tran.open_ts >= ctct.open_ts ( +) and ord_tran.open_ts < ctct.clse_ts  an d ord_tran.open_ts >= cust.open_ts  LEFT OUTER JOIN (select cust_key,cust_id,op en_ts,clse_ts  from ep_rel.cus t where ecf_delt_flg = 0) cust ON ord_tran.cust_key = cust.cust_key and ord_tran.open_ts < ctct.clse_ts  an d ord_tran.open_ts >= cust.open_ts  and ord_tran.open_ts < ctct.clse_ts  an d ord_tran.open_ts >= cust.open_ts  LEFT OUTER JOIN ( from ect base_ plan_ind, open_ts, clse_ts, bill_offr_key, bill_offr_ds f rom ep_rel.bill_offr where ecf_delt_flg = 0) assg_bill_o ffr ON ord_tran.bill_offr_key = assg_bill_offr.bill _offr_key  and ord_tran.prod_ctlg_key = assg_cmpn_ offr.prod_ctlg_key  and ord_tran.op en_ts >= assg_bill_offr.open_ts  and ord_tran.open_ts < assg_cmpn_offr.clse_ts  a nd ord_tran.open_ts >= assg_prod_stat.open_ts  LEFT OUTER JOIN (select prod_ctlg_item_id,prod_ctlg_key, prod_ds,open _ts,clse_ts  from ep_rel.prod_ctlg where ecf_delt_flg = 0) assg_cmpn_offr ON ord_ tran.open_ts >= assg_cmpn_offr.open_ts  and ord_tran.open_ts < assg_cmpn_offr.clse_ts  a nd ord_tran.open_ts >= assg_prod_stat.open_ts  and ord_tran.open_ts < assg_cmpn_offr.clse_ts  a nd ord_tran.open_ts >= assg_prod_stat.open_ts  LEFT OUTER JOIN (select assg_prod_stat_id,ope n_ts,clse_ts,assg_prod_stat_key  from ep_rel.assg_ prod_stat where ecf_delt_flg = 0) assg_prod_stat ON ord_tran.assg_prod_stat_key = assg_prod_stat.assg_prod_stat_key and ord_tran.open_ts < assg_cmpn_offr.clse_ts  a nd ord_tran.open_ts >= assg_prod_stat.open_ts  and ord_tran.open_ts < assg_cmpn_offr.clse_ts  a nd ord_tran.open_ts >= assg_prod_stat.open_ts  and ord_tran.open_ts < assg_cmpn_offr.clse_ts  a nd ord_tran.open_ts >= assg_prod_stat.open_ts  and ord_tran.open_ts < assg_prod_stat.clse_ts  LEFT OUTER JOIN (sele ct sale_serv_chnl_key, sale_serv_chnl_nm, open_ts, clse_ts  from ep_rel.sale_serv_chnl where ecf_delt_flg = 0) chn l_nm ON ord_tran.init_sale_s erv_chnl_key = chnl_nm.sale_serv_chnl_key and ord_tran.open_ts >= chnl_nm.open_ts  and ord_tran.open_ts < chnl_nm.clse_ts  a nd ord_tran.crte_empl_key = empl.empl_key -- added LEFT OUTER JOIN ( from ect empl_or_ssmn_cd, open_ts, clse_ts, empl_key fro m ep_rel.empl where ecf_delt_flg =) empl -- added on 13 aug 18 where ord_tran.open_ts >= ctct.open_ts ( +) and upper(ord_tran.main_cmpn_nm) in ('tv main','cross carr iage main') and upper(oa_type.ord_actn_type_ds) in ( 'provide' ) and ord_tran.ecf_delt_flg = 0 and upper(ctct.frst_nm) not like 'brt%' and ord_tran.ord_actn_strt_date_key between to_ch ar(trunc(sysdate-7, 'iw'),'yyyymmdd') and to_char(next_day(trunc (sysdate-7,'iw'),'sunday'),'yyyymmdd') --and ord_tran.ord_actn _strt_date_key between 20180910 and 20180916 --and assg_cmpn_o ffr.prod_ctlg_item_id in ('8635012' ,'8900892' ,'8704672' ,'8633 012' ,'8632982');