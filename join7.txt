CREATE TABLE BCC_BB_OED_RECON_MIG as  SELECT DISTINCT ORD_TRAN.O
RD_ACTN_ID        AS ORD_ACTN_ID ,                 ORD_TRAN.ORD_
ID             AS ORDER_ID,                 ORD_TRAN.DEAL_ID,
ORD_TRAN.DEAL_NM,                 ORD_TRAN.VNDR_ID
,                 ORD_TRAN.VNDR_NM,                 ORD_TRAN.CUS
T_RQST_TS,                 SUBS.BB_USER_NM,                 SUBS
.ACCS_LKGE_ID,                 EMPL.EMPL_OR_SSMN_CD,
ORD_TRAN.ORD_ACTN_STRT_TS   AS ORD_ACTN_STRT_TS ,
ORD_TRAN.ORD_ACTN_STRT_DATE_KEY,                 ORD_TRAN
.MAIN_CMPN_NM,                 ASSG_CMPN_OFFR.PROD_DS CMPN_PROD_
DS,                 ASSG_BILL_OFFR.BILL_OFFR_DS BILL_OFFR_DS,
ASSG_BILL_OFFR.BASE_PLAN_IND,                 CUST
.CUST_ID,                 CTCT.IDNT_DOC_1_NO          AS CUST_CT
CT_IDNT_DOC_1_NO ,                 CTCT.FRST_NM,
SUBS.PRIM_RSRC_VALU_TXT     AS PRIM_RSRC_VALU_TXT ,
ORD_TRAN.SERV_TYPE_CD       AS SERV_TYPE_CD,
ORD_TRAN.ORD_ACTN_DONE_TS   AS ORD_ACTN_DONE_TS ,
ORD_TRAN.ORD_ACTN_DONE_DATE_KEY,                 ORD_TRAN.OR
D_TRAN_YEAR_MNTH_NO,                 SUBS.SUBS_ID
AS SUBS_ID ,                 OA_STTS.ORD_ACTN_STTS_DS    as ORD
_ACTN_STTS_DS ,                 ASSG_PROD_STAT.ASSG_PROD_STAT_ID
,                 OA_TYPE.ORD_ACTN_TYPE_DS    AS ORD_ACTN_TYPE_D
S ,                 OA_RSN.ORD_ACTN_RSN_DS      AS ORD_ACTN_RSN_
DS ,                 ORD_TRAN.ASSG_PROD_ID       AS ASSG_PROD_ID
,                 ORD_TRAN.MAIN_CMPN_ID,                 ORD_TR
AN.ASSG_PRCE_PLAN_ID  AS ASSG_PRCE_PLAN_ID,                 PROD
_OFFR.PROD_DS           AS MAIN_PROD_OFFR_DS,             AP_CLS
S.SERV_TECH_NM        AS MAIN_PROD_OFFR_CLSS_DS,             AP_
PREV_CLSS.SERV_TECH_NM   AS PREV_MAIN_PROD_OFFR_CLSS_DS,
ASSG_BILL_OFFR.BILL_OFFR_ID, -- added to populate confi
g table                 CHNL_NM.SALE_SERV_CHNL_NM  FROM EP_REL.O
RD_TRAN, (SELECT SUBS_KEY,ACCS_LKGE_ID,SUBS_ID,BB_USER_NM,PRIM_R
SRC_VALU_TXT,OPEN_TS,CLSE_TS,MAIN_PROD_OFFR_CLSS_DS,PREV_MAIN_PR
OD_OFFR_CLSS_DS,MAIN_PROD_OFFR_DS,PREV_MAIN_PROD_OFFR_DS FROM EP
_REL.SUBS WHERE  ECF_DELT_FLG = 0  )  SUBS, (SELECT ORD_ACTN_STT
S_KEY,ORD_ACTN_STTS_DS,OPEN_TS,CLSE_TS FROM EP_REL.ORD_ACTN_STTS
WHERE  ECF_DELT_FLG = 0  )  OA_STTS, (SELECT ORD_ACTN_TYPE_KEY
,ORD_ACTN_TYPE_DS,ORD_ACTN_TYPE_ID,OPEN_TS,CLSE_TS FROM EP_REL.O
RD_ACTN_TYPE  WHERE  ECF_DELT_FLG = 0  )  OA_TYPE, (SELECT ORD_A
CTN_RSN_KEY,ORD_ACTN_RSN_DS,ORD_ACTN_RSN_ID,OPEN_TS,CLSE_TS FROM
EP_REL.ORD_ACTN_RSN  WHERE  ECF_DELT_FLG = 0  )  OA_RSN, (SELEC
T CTCT_KEY,IDNT_DOC_1_NO,OPEN_TS,CLSE_TS,FRST_NM FROM EP_REL.CTC
T WHERE  ECF_DELT_FLG = 0  ) CTCT, (SELECT CUST_KEY,CUST_ID,OPEN
_TS,CLSE_TS FROM EP_REL.CUST WHERE  ECF_DELT_FLG = 0  ) CUST, (S
ELECT BASE_PLAN_IND,OPEN_TS,CLSE_TS,BILL_OFFR_KEY,BILL_OFFR_DS,B
ILL_OFFR_ID  FROM EP_REL.BILL_OFFR WHERE  ECF_DELT_FLG = 0  ) AS
SG_BILL_OFFR, (SELECT PROD_CTLG_ITEM_ID,PROD_CTLG_KEY, PROD_DS,O
PEN_TS,CLSE_TS FROM EP_REL.PROD_CTLG WHERE  ECF_DELT_FLG = 0  )
ASSG_CMPN_OFFR, (SELECT EMPL_OR_SSMN_CD,OPEN_TS,CLSE_TS,EMPL_KEY
from EP_REL.EMPL  where ECF_DELT_FLG = 0) EMPL, (SELECT ASSG_PR
OD_STAT_ID,OPEN_TS,CLSE_TS,ASSG_PROD_STAT_KEY FROM EP_REL.ASSG_P
ROD_STAT WHERE  ECF_DELT_FLG = 0  ) ASSG_PROD_STAT, (select PROD
_DS , PROD_cTLG_KEY FROM EP_REL.PROD_CTLG WHERE ECF_DELT_FLG=0 A
ND ECF_XPIR_TS='31-DEC-9999') PROD_OFFR, (SELECT ASSG_PROD_ID,SE
RV_TECH_NM FROM ( select ASSG_PROD_ID,SERV_TECH_NM, rank() over
( partition by assg_prod_id order by strt_ts desc,end_ts desc,as
sg_prod_vrsn_id desc) as RANK FROM EP_REL.ASSG_PROD AP WHERE AP.
ECF_XPIR_TS='31-dec-9999' AND AP.MAIN_CMPN_FLG=1 AND AP.SERV_TEC
H_NM IS NOT NULL ) WHERE RANK=1 ) AP_CLSS, (select ASSG_PROD_ID,
SERV_TECH_NM from ( select ASSG_PROD_ID,SERV_TECH_NM,rank() over
( partition by assg_prod_id order by strt_ts desc,end_ts desc,a
ssg_prod_vrsn_id desc) as RANK FROM EP_REL.ASSG_PROD AP WHERE AP
.ECF_XPIR_TS='31-dec-9999' AND AP.MAIN_CMPN_FLG=1 AND AP.SERV_TE
CH_NM IS NOT NULL ) WHERE RANK=2) AP_PREV_CLSS , (SELECT SALE_SE
RV_CHNL_KEY, SALE_SERV_CHNL_NM, OPEN_TS, CLSE_TS
FROM EP_REL.SALE_SERV_CHNL WHERE  ECF_DELT_FLG = 0  ) CHNL_NM
WHERE ORD_TRAN.SUBS_KEY           = SUBS.SUBS_KEY (+)   AND ORD_
TRAN.BILL_OFFR_KEY      = ASSG_BILL_OFFR.BILL_OFFR_KEY (+)   AND
ORD_TRAN.PROD_CTLG_KEY      = ASSG_CMPN_OFFR.PROD_CTLG_KEY (+)
AND ORD_TRAN.ORD_ACTN_STTS_KEY  = OA_STTS.ORD_ACTN_STTS_KEY (+
)   AND ORD_TRAN.ORD_ACTN_TYPE_KEY  = OA_TYPE.ORD_ACTN_TYPE_KEY
(+)   AND ORD_TRAN.ORD_ACTN_RSN_KEY   = OA_RSN.ORD_ACTN_RSN_KEY
(+)   AND ORD_TRAN.MAIN_CTCT_KEY      = CTCT.CTCT_KEY(+)   AND O
RD_TRAN.CUST_KEY           = CUST.CUST_KEY(+)   AND ORD_TRAN.ASS
G_PROD_STAT_KEY = ASSG_PROD_STAT.ASSG_PROD_STAT_KEY(+)   AND ORD
_TRAN.CRTE_EMPL_KEY      = EMPL.EMPL_KEY(+)   AND ORD_TRAN.MAIN_
PROD_OFFR_KEY = PROD_OFFR.PROD_CTLG_KEY   AND ORD_TRAN.MAIN_CMPN
_ID       = AP_CLSS.ASSG_PROD_ID (+)   AND ORD_TRAN.MAIN_CMPN_ID
= AP_PREV_CLSS.ASSG_PROD_ID (+)   AND ORD_TRAN.OPEN_TS
>= SUBS.OPEN_TS (+)   AND ORD_TRAN.OPEN_TS            <
SUBS.CLSE_TS (+)   AND ORD_TRAN.OPEN_TS            >= OA_STTS.O
PEN_TS (+)   AND ORD_TRAN.OPEN_TS            < OA_STTS.CLSE_TS (
+)   AND ORD_TRAN.OPEN_TS            >= OA_TYPE.OPEN_TS (+)   AN
D ORD_TRAN.OPEN_TS            < OA_TYPE.CLSE_TS (+)   AND ORD_TR
AN.OPEN_TS            >= OA_RSN.OPEN_TS (+)   AND ORD_TRAN.OPEN_
TS            < OA_RSN.CLSE_TS (+)   AND ORD_TRAN.OPEN_TS
>= CTCT.OPEN_TS (+)   AND ORD_TRAN.OPEN_TS            < CTC
T.CLSE_TS (+)   AND ORD_TRAN.OPEN_TS            >= CUST.OPEN_TS
(+)   AND ORD_TRAN.OPEN_TS            < CUST.CLSE_TS (+)   AND O
RD_TRAN.OPEN_TS            >= ASSG_BILL_OFFR.OPEN_TS (+)   AND O
RD_TRAN.OPEN_TS            < ASSG_BILL_OFFR.CLSE_TS (+)   AND OR
D_TRAN.OPEN_TS            >= ASSG_CMPN_OFFR.OPEN_TS (+)   AND OR
D_TRAN.OPEN_TS            < ASSG_CMPN_OFFR.CLSE_TS (+)   AND ORD
_TRAN.OPEN_TS            >= ASSG_PROD_STAT.OPEN_TS (+)   AND ORD
_TRAN.OPEN_TS            < ASSG_PROD_STAT.CLSE_TS (+)   AND ORD_
TRAN.OPEN_TS            >= EMPL.OPEN_TS (+)   AND ORD_TRAN.OPEN_
TS            < EMPL.CLSE_TS (+)   AND ORD_TRAN.OPEN_TS
>= CHNL_NM.OPEN_TS (+)   AND ORD_TRAN.OPEN_TS            < CH
NL_NM.CLSE_TS (+)    /*AND ORD_TRAN.ORD_ACTN_STRT_DATE_KEY BETWE
EN 20180201 AND 20180227*/   AND UPPER(ORD_TRAN.MAIN_CMPN_NM) IN
('BROADBAND MAIN')   AND UPPER(OA_TYPE.ORD_ACTN_TYPE_DS) IN ( '
CHANGE' )   AND UPPER(ORD_ACTN_RSN_DS) in ('RECONTRACTING','CHAN
GE PLAN')   AND ORD_TRAN.MAIN_CTCT_KEY <> -1   AND UPPER(CTCT.FR
ST_NM) NOT LIKE 'BRT%'   AND ORD_TRAN.ECF_DELT_FLG = 0   AND ASS
G_CMPN_OFFR.PROD_CTLG_ITEM_ID = '8623942'   AND ASSG_PRCE_PLAN_I
D <> -1   AND ASSG_PRC_PLAN_STTS_KEY <> 3   AND ORD_ACTN_STRT_DA
TE_KEY between TO_CHAR(TRUNC(SYSDATE-7, 'IW'),'YYYYMMDD') AND TO
_CHAR(NEXT_DAY(TRUNC(SYSDATE-7,'IW'),'SUNDAY'),'YYYYMMDD')  ---
For TV OED;   -- AND ORD_TRAN.ORD_ACTN_STRT_DATE_KEY BETWEEN 201
80910 and 20180916