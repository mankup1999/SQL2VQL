SELECT DISTINCT                  ORD_TRAN.ORD_ACTN_ID        AS
ORD_ACTN_ID ,                 ORD_TRAN.ORD_ACTN_STRT_TS   AS ORD
_ACTN_STRT_TS ,                 ORD_TRAN.ORD_ACTN_STRT_DATE_KEY,
ORD_TRAN.MAIN_CMPN_NM,                 ORD_TRAN
.DEAL_ID,                 Case When SUBS_DVR.DVR_FLAG ='Y' Then
'Y' Else 'N' END  AS  DVR_FLAG,                 ASSG_CMPN_OFFR.P
ROD_DS CMPN_PROD_DS,                 ASSG_BILL_OFFR.BILL_OFFR_DS
BILL_OFFR_DS,                 ASSG_BILL_OFFR.BASE_PLAN_IND,
CUST.CUST_ID,                 SUBS.
MAIN_PROD_OFFR_DS,                 CTCT.IDNT_DOC_1_NO          A
S CUST_CTCT_IDNT_DOC_1_NO ,                 CTCT.FRST_NM,
SUBS.PRIM_RSRC_VALU_TXT     AS PRIM_RSRC_VALU_TXT ,
ORD_TRAN.SERV_TYPE_CD       AS SERV_TYPE_CD,
ORD_TRAN.ORD_ACTN_DONE_TS   AS ORD_ACTN_DONE_TS
,                                 ORD_TRAN.ORD_ACTN_DONE_DATE_KE
Y,                 SUBS.SUBS_ID                AS SUBS_ID ,
OA_STTS.ORD_ACTN_STTS_DS
as ORD_ACTN_STTS_DS ,                 ORD_TRAN.ORD_TRAN_YEAR_
MNTH_NO,                                 ASSG_PROD_STAT.ASSG_PRO
D_STAT_ID,                 OA_TYPE.ORD_ACTN_TYPE_DS    AS ORD_AC
TN_TYPE_DS ,                 OA_RSN.ORD_ACTN_RSN_DS      AS ORD_
ACTN_RSN_DS ,                 ORD_TRAN.ASSG_PROD_ID       AS ASS
G_PROD_ID ,                 SALE_SERV_CHNL.SALE_SERV_CHNL_NM,
ORD_TRAN.MAIN_CMPN_ID,                 EMPL.EMPL_O
R_SSMN_CD,                 ORD_TRAN.ASSG_PRCE_PLAN_ID  as ASSG_P
RCE_PLAN_ID  FROM (SELECT * FROM EP_REL.ORD_TRAN WHERE ORD_TRAN.
ORD_ACTN_STRT_DATE_KEY BETWEEN 20190501 AND 20190502) ORD_TRAN,-
-EP_REL.ORD_TRAN, (SELECT SUBS_KEY,SUBS_ID,MAIN_PROD_OFFR_DS,DVR
_FLG ,PRIM_RSRC_VALU_TXT,OPEN_TS,CLSE_TS FROM EP_REL.SUBS WHERE
ECF_DELT_FLG = 0  )  SUBS, (SELECT ORD_ACTN_STTS_KEY,ORD_ACTN_S
TTS_DS,OPEN_TS,CLSE_TS FROM EP_REL.ORD_ACTN_STTS  WHERE  ECF_DEL
T_FLG = 0 AND ORD_ACTN_STTS_KEY IN (2,1,4)  )  OA_STTS, (SELECT
ORD_ACTN_TYPE_KEY,ORD_ACTN_TYPE_DS,ORD_ACTN_TYPE_ID,OPEN_TS,CLSE
_TS FROM EP_REL.ORD_ACTN_TYPE  WHERE  ECF_DELT_FLG = 0  )  OA_TY
PE, (SELECT ORD_ACTN_RSN_KEY,ORD_ACTN_RSN_DS,ORD_ACTN_RSN_ID,OPE
N_TS,CLSE_TS FROM EP_REL.ORD_ACTN_RSN  WHERE  ECF_DELT_FLG = 0
)  OA_RSN, (SELECT CTCT_KEY,IDNT_DOC_1_NO,OPEN_TS,CLSE_TS,FRST_N
M FROM EP_REL.CTCT WHERE  ECF_DELT_FLG = 0  ) CTCT, (SELECT CUST
_KEY,CUST_ID,OPEN_TS,CLSE_TS FROM EP_REL.CUST WHERE  ECF_DELT_FL
G = 0  ) CUST, (SELECT /*+ PARALLEL(4) */  ASSG_PROD_PARM.PARM_V
ALU_TXT AS PARM_VALU_TXT,ASSG_PROD.CUST_KEY AS CUST_KEY,ORD_ACTN
.ORD_ACTN_KEY,ORD_ACTN.OPEN_TS,ORD_ACTN.CLSE_TS,ASSG_PROD.ASSG_P
ROD_KEY, case when UPPER(ASSG_PROD_PARM.PARM_VALU_TXT)=UPPER('DV
R') then 'Y' else 'N' END AS DVR_FLAG FROM EP_REL.ASSG_PROD,EP_R
EL.ASSG_PROD_PARM,EP_REL.ORD_ACTN WHERE ASSG_PROD.ASSG_PROD_STAT
_KEY in (5,4) AND ASSG_PROD.ASSG_PROD_STTS_KEY=10 AND ASSG_PROD.
ASSG_PROD_KEY=ASSG_PROD_PARM.ASSG_PROD_KEY AND ASSG_PROD.ORD_ACT
N_KEY=ORD_ACTN.ORD_ACTN_KEY AND ASSG_PROD.SERV_TYPE_CD = 'STB'
AND UPPER(ASSG_PROD_PARM.PARM_NM)=UPPER('STB_TYPE_TV') AND UPPER
(ASSG_PROD_PARM.PARM_VALU_TXT)=UPPER('DVR') --AND TO_CHAR(ASSG_P
ROD.END_TS,'YYYYMMDD')>'20180104'  -- this will be run date AND
TRUNC(ASSG_PROD.ECF_XPIR_TS)='31-DEC-9999'  AND ASSG_PROD.ECF_DE
LT_FLG='0' AND TRUNC(ORD_ACTN.ECF_XPIR_TS)='31-DEC-9999'  AND OR
D_ACTN.ECF_DELT_FLG='0' AND TRUNC(ASSG_PROD_PARM.ECF_XPIR_TS)='3
1-DEC-9999'  AND ASSG_PROD_PARM.ECF_DELT_FLG='0') SUBS_DVR, (SEL
ECT BASE_PLAN_IND,OPEN_TS,CLSE_TS,BILL_OFFR_KEY,BILL_OFFR_DS FRO
M EP_REL.BILL_OFFR WHERE  ECF_DELT_FLG = 0 AND BILL_OFFR_DS IS N
OT NULL ) ASSG_BILL_OFFR, (SELECT PROD_CTLG_ITEM_ID,PROD_CTLG_KE
Y, PROD_DS,OPEN_TS,CLSE_TS FROM EP_REL.PROD_CTLG WHERE  ECF_DELT
_FLG = 0  ) ASSG_CMPN_OFFR, (SELECT ASSG_PROD_STAT_ID,OPEN_TS,CL
SE_TS,ASSG_PROD_STAT_KEY FROM EP_REL.ASSG_PROD_STAT WHERE  ECF_D
ELT_FLG = 0  ) ASSG_PROD_STAT, (SELECT SALE_SERV_CHNL_KEY,SALE_S
ERV_CHNL_NM,OPEN_TS,CLSE_TS from ep_rel.SALE_SERV_CHNL where ECF
_DELT_FLG = 0) SALE_SERV_CHNL, (SELECT EMPL_OR_SSMN_CD,OPEN_TS,C
LSE_TS,EMPL_KEY from ep_rel.EMPL where ECF_DELT_FLG = 0) EMPL WH
ERE  ORD_TRAN.SUBS_KEY                    = SUBS.SUBS_KEY (+) AN
D ORD_TRAN.ASSG_PROD_KEY          = SUBS_DVR.ASSG_PROD_KEY (+) A
ND ORD_TRAN.BILL_OFFR_KEY          = ASSG_BILL_OFFR.BILL_OFFR_KE
Y (+) AND ORD_TRAN.PROD_CTLG_KEY          = ASSG_CMPN_OFFR.PROD_
CTLG_KEY (+) AND ORD_TRAN.ORD_ACTN_STTS_KEY      = OA_STTS.ORD_A
CTN_STTS_KEY (+) AND ORD_TRAN.ORD_ACTN_TYPE_KEY      = OA_TYPE.O
RD_ACTN_TYPE_KEY (+) AND ORD_TRAN.ORD_ACTN_RSN_KEY       = OA_RS
N.ORD_ACTN_RSN_KEY (+) AND ORD_TRAN.MAIN_CTCT_KEY          = CTC
T.CTCT_KEY(+) AND ORD_TRAN.CUST_KEY               = CUST.CUST_KE
Y(+) AND ORD_TRAN.ASSG_PROD_STAT_KEY     = ASSG_PROD_STAT.ASSG_P
ROD_STAT_KEY(+) AND ORD_TRAN.CRTE_EMPL_KEY = EMPL.EMPL_KEY(+) AN
D ORD_TRAN.INIT_SALE_SERV_CHNL_KEY = SALE_SERV_CHNL.SALE_SERV_CH
NL_KEY(+) AND ORD_TRAN.OPEN_TS          >= SUBS.OPEN_TS (+) AND
ORD_TRAN.OPEN_TS           < SUBS.CLSE_TS (+) AND ORD_TRAN.OPEN_
TS          >= OA_STTS.OPEN_TS (+) AND ORD_TRAN.OPEN_TS
< OA_STTS.CLSE_TS (+) AND ORD_TRAN.OPEN_TS          >= OA_TYPE
.OPEN_TS (+) AND ORD_TRAN.OPEN_TS           < OA_TYPE.CLSE_TS (+
) AND ORD_TRAN.OPEN_TS          >= OA_RSN.OPEN_TS (+) AND ORD_TR
AN.OPEN_TS           < OA_RSN.CLSE_TS (+) AND ORD_TRAN.OPEN_TS
>= CTCT.OPEN_TS (+) AND ORD_TRAN.OPEN_TS
< CTCT.CLSE_TS (+) AND ORD_TRAN.OPEN_TS                  >=
CUST.OPEN_TS (+) AND ORD_TRAN.OPEN_TS                   < CUST.
CLSE_TS (+) AND ORD_TRAN.OPEN_TS                  >= ASSG_BILL_O
FFR.OPEN_TS (+) AND ORD_TRAN.OPEN_TS                   < ASSG_BI
LL_OFFR.CLSE_TS (+) AND ORD_TRAN.OPEN_TS                  >= ASS
G_CMPN_OFFR.OPEN_TS (+) AND ORD_TRAN.OPEN_TS                   <
ASSG_CMPN_OFFR.CLSE_TS (+)   AND ORD_TRAN.OPEN_TS
>= ASSG_PROD_STAT.OPEN_TS (+) AND ORD_TRAN.OPEN_TS
< ASSG_PROD_STAT.CLSE_TS (+)  AND ORD_TRAN.OPEN_TS
>= SUBS_DVR.OPEN_TS (+) AND ORD_TRAN.OPEN_TS
< SUBS_DVR.CLSE_TS (+)  AND ORD_TRAN.OPEN_TS >= EMPL
.OPEN_TS (+) AND ORD_TRAN.OPEN_TS < EMPL.CLSE_TS (+) AND ORD_TRA
N.OPEN_TS >= SALE_SERV_CHNL.OPEN_TS (+) AND ORD_TRAN.OPEN_TS < S
ALE_SERV_CHNL.CLSE_TS (+) --AND ORD_TRAN.ORD_ACTN_STRT_DATE_KEY
BETWEEN 20190301 AND 2019028 AND UPPER(ORD_TRAN.MAIN_CMPN_NM) IN
('TV MAIN','CROSS CARRIAGE MAIN')    AND UPPER(OA_TYPE.ORD_ACTN
_TYPE_DS)       IN ( 'PROVIDE' ) AND ORD_TRAN.ECF_DELT_FLG = 0