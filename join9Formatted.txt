select distinct ord_tran.ord_actn_id as ord_actn_id , ord_tran.ord_actn_strt_ts as ord _actn_strt_ts , ord_tran.ord_actn_strt_date_key, ord_tran.main_cmpn_nm, ord_tran .deal_id, case when subs_dvr.dvr_flag ='y' then 'y' else 'n' end as dvr_flag, assg_cmpn_offr.p rod_ds cmpn_prod_ds, assg_bill_offr.bill_offr_ds bill_offr_ds, assg_bill_offr.base_plan_ind, cust.cust_id, subs. main_prod_offr_ds, ctct.idnt_doc_1_no a s cust_ctct_idnt_doc_1_no , ctct.frst_nm, subs.prim_rsrc_valu_txt as prim_rsrc_valu_txt , ord_tran.serv_type_cd as serv_type_cd, ord_tran.ord_actn_done_ts as ord_actn_done_ts , ord_tran.ord_actn_done_date_ke y, subs.subs_id as subs_id , oa_stts.ord_actn_stts_ds as ord_actn_stts_ds , ord_tran.ord_tran_year_ mnth_no, assg_prod_stat.assg_pro d_stat_id, oa_type.ord_actn_type_ds as ord_ac tn_type_ds , oa_rsn.ord_actn_rsn_ds as ord_ actn_rsn_ds , ord_tran.assg_prod_id as ass g_prod_id , sale_serv_chnl.sale_serv_chnl_nm, ord_tran.main_cmpn_id, empl.empl_o r_ssmn_cd, ord_tran.assg_prce_plan_id as assg_p rce_plan_id from (select * from ep_rel.ord_tran where ord_tran. ord_actn_strt_date_key between 20190501 and 20190502) ord_tran,- -ep_rel.ord_tran, (select subs_key,subs_id,main_prod_offr_ds,dvr _flg ,prim_rsrc_valu_txt,open_ts,clse_ts from ep_rel.subs where ecf_delt_flg = 0 ) subs, (select ord_actn_stts_key,ord_actn_s tts_ds,open_ts,clse_ts from ep_rel.ord_actn_stts where ecf_del t_flg = 0 and ord_actn_stts_key in (2,1,4) ) oa_stts, (select ord_actn_type_key,ord_actn_type_ds,ord_actn_type_id,open_ts,clse _ts from ep_rel.ord_actn_type where ecf_delt_flg = 0 ) oa_ty pe, (select ord_actn_rsn_key,ord_actn_rsn_ds,ord_actn_rsn_id,ope n_ts,clse_ts from ep_rel.ord_actn_rsn where ecf_delt_flg = 0 ) oa_rsn, (select ctct_key,idnt_doc_1_no,open_ts,clse_ts,frst_n m from ep_rel.ctct where ecf_delt_flg = 0 ) ctct, (select cust _key,cust_id,open_ts,clse_ts from ep_rel.cust where ecf_delt_fl g = 0 ) cust, (select /*+ parallel(4) */ assg_prod_parm.parm_v alu_txt as parm_valu_txt,assg_prod.cust_key as cust_key,ord_actn .ord_actn_key,ord_actn.open_ts,ord_actn.clse_ts,assg_prod.assg_p rod_key, case when upper(assg_prod_parm.parm_valu_txt)=upper('dv r') then 'y' else 'n' end as dvr_flag from ep_rel.assg_prod,ep_r el.assg_prod_parm,ep_rel.ord_actn where assg_prod.assg_prod_stat _key in (5,4) and assg_prod.assg_prod_stts_key=10 and assg_prod. assg_prod_key=assg_prod_parm.assg_prod_key and assg_prod.ord_act n_key=ord_actn.ord_actn_key and assg_prod.serv_type_cd = 'stb' and upper(assg_prod_parm.parm_nm)=upper('stb_type_tv') and upper (assg_prod_parm.parm_valu_txt)=upper('dvr') --and to_char(assg_p rod.end_ts,'yyyymmdd')>'20180104' -- this will be run date and trunc(assg_prod.ecf_xpir_ts)='31-dec-9999' and assg_prod.ecf_de lt_flg='0' and trunc(ord_actn.ecf_xpir_ts)='31-dec-9999' and or d_actn.ecf_delt_flg='0' and trunc(assg_prod_parm.ecf_xpir_ts)='3 1-dec-9999' and assg_prod_parm.ecf_delt_flg='0') subs_dvr, (sel ect base_plan_ind,open_ts,clse_ts,bill_offr_key,bill_offr_ds fro m ep_rel.bill_offr where ecf_delt_flg = 0 and bill_offr_ds is n ot null ) assg_bill_offr, (select prod_ctlg_item_id,prod_ctlg_ke y, prod_ds,open_ts,clse_ts from ep_rel.prod_ctlg where ecf_delt _flg = 0 ) assg_cmpn_offr, (select assg_prod_stat_id,open_ts,cl se_ts,assg_prod_stat_key from ep_rel.assg_prod_stat where ecf_d elt_flg = 0 ) assg_prod_stat, (select sale_serv_chnl_key,sale_s erv_chnl_nm,open_ts,clse_ts from ep_rel.sale_serv_chnl where ecf _delt_flg = 0) sale_serv_chnl, (select empl_or_ssmn_cd,open_ts,c lse_ts,empl_key from ep_rel.empl where ecf_delt_flg = 0) empl where ord_tran.subs_key = subs.subs_key (+) an d ord_tran.assg_prod_key = subs_dvr.assg_prod_key (+) a nd ord_tran.bill_offr_key = assg_bill_offr.bill_offr_ke y (+) and ord_tran.prod_ctlg_key = assg_cmpn_offr.prod_ ctlg_key (+) and ord_tran.ord_actn_stts_key = oa_stts.ord_a ctn_stts_key (+) and ord_tran.ord_actn_type_key = oa_type.o rd_actn_type_key (+) and ord_tran.ord_actn_rsn_key = oa_rs n.ord_actn_rsn_key (+) and ord_tran.main_ctct_key = ctc t.ctct_key(+) and ord_tran.cust_key = cust.cust_ke y(+) and ord_tran.assg_prod_stat_key = assg_prod_stat.assg_p rod_stat_key(+) and ord_tran.crte_empl_key = empl.empl_key(+) an d ord_tran.init_sale_serv_chnl_key = sale_serv_chnl.sale_serv_ch nl_key(+) and ord_tran.open_ts >= subs.open_ts (+) and ord_tran.open_ts < subs.clse_ts (+) and ord_tran.open_ ts >= oa_stts.open_ts (+) and ord_tran.open_ts < oa_stts.clse_ts (+) and ord_tran.open_ts >= oa_type .open_ts (+) and ord_tran.open_ts < oa_type.clse_ts (+) and ord_tran.open_ts >= oa_rsn.open_ts (+) and ord_tr an.open_ts < oa_rsn.clse_ts (+) and ord_tran.open_ts >= ctct.open_ts (+) and ord_tran.open_ts < ctct.clse_ts (+) and ord_tran.open_ts >= cust.open_ts (+) and ord_tran.open_ts < cust. clse_ts (+) and ord_tran.open_ts >= assg_bill_o ffr.open_ts (+) and ord_tran.open_ts < assg_bi ll_offr.clse_ts (+) and ord_tran.open_ts >= ass g_cmpn_offr.open_ts (+) and ord_tran.open_ts < assg_cmpn_offr.clse_ts (+) and ord_tran.open_ts >= assg_prod_stat.open_ts (+) and ord_tran.open_ts < assg_prod_stat.clse_ts (+) and ord_tran.open_ts >= subs_dvr.open_ts (+) and ord_tran.open_ts < subs_dvr.clse_ts (+) and ord_tran.open_ts >= empl .open_ts (+) and ord_tran.open_ts < empl.clse_ts (+) and ord_tra n.open_ts >= sale_serv_chnl.open_ts (+) and ord_tran.open_ts < s ale_serv_chnl.clse_ts (+) --and ord_tran.ord_actn_strt_date_key between 20190301 and 2019028 and upper(ord_tran.main_cmpn_nm) in ('tv main','cross carriage main') and upper(oa_type.ord_actn _type_ds) in ( 'provide' ) and ord_tran.ecf_delt_flg = 0;