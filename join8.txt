CREATE TABLE BCC_WK_BB_OED_RECON_MIG as  SELECT DISTINCT ORD_TRA
N.ORD_ACTN_ID        AS ORD_ACTN_ID ,                 ORD_TRAN.O
RD_ID             AS ORDER_ID,                 ORD_TRAN.DEAL_ID,
ORD_TRAN.DEAL_NM,                 ORD_TRAN.VNDR
_ID,                 ORD_TRAN.VNDR_NM,                 ORD_TRAN.
CUST_RQST_TS,                 SUBS.BB_USER_NM,                 S
UBS.ACCS_LKGE_ID,                 EMPL.EMPL_OR_SSMN_CD,
ORD_TRAN.ORD_ACTN_STRT_TS   AS ORD_ACTN_STRT_TS ,
ORD_TRAN.ORD_ACTN_STRT_DATE_KEY,                 ORD_T
RAN.MAIN_CMPN_NM,                 ASSG_CMPN_OFFR.PROD_DS CMPN_PR
OD_DS,                 ASSG_BILL_OFFR.BILL_OFFR_DS BILL_OFFR_DS,
ASSG_BILL_OFFR.BASE_PLAN_IND,                 C
UST.CUST_ID,                 CTCT.IDNT_DOC_1_NO          AS CUST
_CTCT_IDNT_DOC_1_NO ,                 CTCT.FRST_NM,
SUBS.PRIM_RSRC_VALU_TXT     AS PRIM_RSRC_VALU_TXT ,
ORD_TRAN.SERV_TYPE_CD       AS SERV_TYPE_CD,
ORD_TRAN.ORD_ACTN_DONE_TS   AS ORD_ACTN_DONE_TS ,
ORD_TRAN.ORD_ACTN_DONE_DATE_KEY,                 ORD_TRAN
.ORD_TRAN_YEAR_MNTH_NO,                 SUBS.SUBS_ID
AS SUBS_ID ,                 OA_STTS.ORD_ACTN_STTS_DS    as
ORD_ACTN_STTS_DS ,                 ASSG_PROD_STAT.ASSG_PROD_STAT
_ID,                 OA_TYPE.ORD_ACTN_TYPE_DS    AS ORD_ACTN_TYP
E_DS ,                 OA_RSN.ORD_ACTN_RSN_DS      AS ORD_ACTN_R
SN_DS ,                 ORD_TRAN.ASSG_PROD_ID       AS ASSG_PROD
_ID ,                 ORD_TRAN.MAIN_CMPN_ID,                 ORD
_TRAN.ASSG_PRCE_PLAN_ID  AS ASSG_PRCE_PLAN_ID,                 P
ROD_OFFR.PROD_DS           AS MAIN_PROD_OFFR_DS,             AP_
CLSS.SERV_TECH_NM        AS MAIN_PROD_OFFR_CLSS_DS,
AP_PREV_CLSS.SERV_TECH_NM   AS PREV_MAIN_PROD_OFFR_CLSS_DS,
ASSG_BILL_OFFR.BILL_OFFR_ID, -- added to populate co
nfig table                 CHNL_NM.SALE_SERV_CHNL_NM  FROM EP_RE
L.ORD_TRAN, (SELECT SUBS_KEY,ACCS_LKGE_ID,SUBS_ID,BB_USER_NM,PRI
M_RSRC_VALU_TXT,OPEN_TS,CLSE_TS,MAIN_PROD_OFFR_CLSS_DS,PREV_MAIN
_PROD_OFFR_CLSS_DS,MAIN_PROD_OFFR_DS,PREV_MAIN_PROD_OFFR_DS FROM
EP_REL.SUBS WHERE  ECF_DELT_FLG = 0  )  SUBS, (SELECT ORD_ACTN_
STTS_KEY,ORD_ACTN_STTS_DS,OPEN_TS,CLSE_TS FROM EP_REL.ORD_ACTN_S
TTS  WHERE  ECF_DELT_FLG = 0  )  OA_STTS, (SELECT ORD_ACTN_TYPE_
KEY,ORD_ACTN_TYPE_DS,ORD_ACTN_TYPE_ID,OPEN_TS,CLSE_TS FROM EP_RE
L.ORD_ACTN_TYPE  WHERE  ECF_DELT_FLG = 0  )  OA_TYPE, (SELECT OR
D_ACTN_RSN_KEY,ORD_ACTN_RSN_DS,ORD_ACTN_RSN_ID,OPEN_TS,CLSE_TS F
ROM EP_REL.ORD_ACTN_RSN  WHERE  ECF_DELT_FLG = 0  )  OA_RSN, (SE
LECT CTCT_KEY,IDNT_DOC_1_NO,OPEN_TS,CLSE_TS,FRST_NM FROM EP_REL.
CTCT WHERE  ECF_DELT_FLG = 0  ) CTCT, (SELECT CUST_KEY,CUST_ID,O
PEN_TS,CLSE_TS FROM EP_REL.CUST WHERE  ECF_DELT_FLG = 0  ) CUST,
(SELECT BASE_PLAN_IND,OPEN_TS,CLSE_TS,BILL_OFFR_KEY,BILL_OFFR_D
S,BILL_OFFR_ID  FROM EP_REL.BILL_OFFR WHERE  ECF_DELT_FLG = 0  )
ASSG_BILL_OFFR, (SELECT PROD_CTLG_ITEM_ID,PROD_CTLG_KEY, PROD_D
S,OPEN_TS,CLSE_TS FROM EP_REL.PROD_CTLG WHERE  ECF_DELT_FLG = 0
) ASSG_CMPN_OFFR, (SELECT EMPL_OR_SSMN_CD,OPEN_TS,CLSE_TS,EMPL_
KEY from EP_REL.EMPL  where ECF_DELT_FLG = 0) EMPL, (SELECT ASSG
_PROD_STAT_ID,OPEN_TS,CLSE_TS,ASSG_PROD_STAT_KEY FROM EP_REL.ASS
G_PROD_STAT WHERE  ECF_DELT_FLG = 0  ) ASSG_PROD_STAT, (select P
ROD_DS , PROD_cTLG_KEY FROM EP_REL.PROD_CTLG WHERE ECF_DELT_FLG=
0 AND ECF_XPIR_TS='31-DEC-9999') PROD_OFFR, (SELECT ASSG_PROD_ID
,SERV_TECH_NM FROM ( select ASSG_PROD_ID,SERV_TECH_NM, rank() ov
er ( partition by assg_prod_id order by strt_ts desc,end_ts desc
,assg_prod_vrsn_id desc) as RANK FROM EP_REL.ASSG_PROD AP WHERE
AP.ECF_XPIR_TS='31-dec-9999' AND AP.MAIN_CMPN_FLG=1 AND AP.SERV_
TECH_NM IS NOT NULL ) WHERE RANK=1 ) AP_CLSS, (select ASSG_PROD_
ID,SERV_TECH_NM from ( select ASSG_PROD_ID,SERV_TECH_NM,rank() o
ver ( partition by assg_prod_id order by strt_ts desc,end_ts des
c,assg_prod_vrsn_id desc) as RANK FROM EP_REL.ASSG_PROD AP WHERE
AP.ECF_XPIR_TS='31-dec-9999' AND AP.MAIN_CMPN_FLG=1 AND AP.SERV
_TECH_NM IS NOT NULL ) WHERE RANK=2) AP_PREV_CLSS , (SELECT SALE
_SERV_CHNL_KEY, SALE_SERV_CHNL_NM, OPEN_TS, CLSE_TS
FROM EP_REL.SALE_SERV_CHNL WHERE  ECF_DELT_FLG = 0  ) CHNL_N
M  WHERE ORD_TRAN.SUBS_KEY           = SUBS.SUBS_KEY (+)   AND O
RD_TRAN.BILL_OFFR_KEY      = ASSG_BILL_OFFR.BILL_OFFR_KEY (+)
AND ORD_TRAN.PROD_CTLG_KEY      = ASSG_CMPN_OFFR.PROD_CTLG_KEY (
+)   AND ORD_TRAN.ORD_ACTN_STTS_KEY  = OA_STTS.ORD_ACTN_STTS_KEY
(+)   AND ORD_TRAN.ORD_ACTN_TYPE_KEY  = OA_TYPE.ORD_ACTN_TYPE_K
EY (+)   AND ORD_TRAN.ORD_ACTN_RSN_KEY   = OA_RSN.ORD_ACTN_RSN_K
EY (+)   AND ORD_TRAN.MAIN_CTCT_KEY      = CTCT.CTCT_KEY(+)   AN
D ORD_TRAN.CUST_KEY           = CUST.CUST_KEY(+)   AND ORD_TRAN.
ASSG_PROD_STAT_KEY = ASSG_PROD_STAT.ASSG_PROD_STAT_KEY(+)   AND
ORD_TRAN.CRTE_EMPL_KEY      = EMPL.EMPL_KEY(+)   AND ORD_TRAN.MA
IN_PROD_OFFR_KEY = PROD_OFFR.PROD_CTLG_KEY   AND ORD_TRAN.MAIN_C
MPN_ID       = AP_CLSS.ASSG_PROD_ID (+)   AND ORD_TRAN.MAIN_CMPN
_ID       = AP_PREV_CLSS.ASSG_PROD_ID (+)   AND ORD_TRAN.OPEN_TS
>= SUBS.OPEN_TS (+)   AND ORD_TRAN.OPEN_TS
< SUBS.CLSE_TS (+)   AND ORD_TRAN.OPEN_TS            >= OA_STT
S.OPEN_TS (+)   AND ORD_TRAN.OPEN_TS            < OA_STTS.CLSE_T
S (+)   AND ORD_TRAN.OPEN_TS            >= OA_TYPE.OPEN_TS (+)
AND ORD_TRAN.OPEN_TS            < OA_TYPE.CLSE_TS (+)   AND ORD
_TRAN.OPEN_TS            >= OA_RSN.OPEN_TS (+)   AND ORD_TRAN.OP
EN_TS            < OA_RSN.CLSE_TS (+)   AND ORD_TRAN.OPEN_TS
>= CTCT.OPEN_TS (+)   AND ORD_TRAN.OPEN_TS            <
CTCT.CLSE_TS (+)   AND ORD_TRAN.OPEN_TS            >= CUST.OPEN_
TS (+)   AND ORD_TRAN.OPEN_TS            < CUST.CLSE_TS (+)   AN
D ORD_TRAN.OPEN_TS            >= ASSG_BILL_OFFR.OPEN_TS (+)   AN
D ORD_TRAN.OPEN_TS            < ASSG_BILL_OFFR.CLSE_TS (+)   AND
ORD_TRAN.OPEN_TS            >= ASSG_CMPN_OFFR.OPEN_TS (+)   AND
ORD_TRAN.OPEN_TS            < ASSG_CMPN_OFFR.CLSE_TS (+)   AND
ORD_TRAN.OPEN_TS            >= ASSG_PROD_STAT.OPEN_TS (+)   AND
ORD_TRAN.OPEN_TS            < ASSG_PROD_STAT.CLSE_TS (+)   AND O
RD_TRAN.OPEN_TS            >= EMPL.OPEN_TS (+)   AND ORD_TRAN.OP
EN_TS            < EMPL.CLSE_TS (+)   AND ORD_TRAN.OPEN_TS
>= CHNL_NM.OPEN_TS (+)   AND ORD_TRAN.OPEN_TS            <
CHNL_NM.CLSE_TS (+)    AND UPPER(ORD_TRAN.MAIN_CMPN_NM) IN ('BR
OADBAND MAIN')   AND UPPER(OA_TYPE.ORD_ACTN_TYPE_DS) IN ( 'CHANG
E' )   AND UPPER(ORD_ACTN_RSN_DS) in ('RECONTRACTING','CHANGE PL
AN')   AND ORD_TRAN.MAIN_CTCT_KEY <> -1   AND UPPER(CTCT.FRST_NM
) NOT LIKE 'BRT%'   AND ORD_TRAN.ECF_DELT_FLG = 0   AND ASSG_CMP
N_OFFR.PROD_CTLG_ITEM_ID = '8623942'   AND ASSG_PRCE_PLAN_ID <>
-1   AND ASSG_PRC_PLAN_STTS_KEY <> 3   AND ORD_ACTN_STRT_DATE_KE
Y BETWEEN (select start_date from oed_vas_dates ) and (select en
d_date from oed_vas_dates)